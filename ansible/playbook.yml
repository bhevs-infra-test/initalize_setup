---
- hosts: controller
  vars_files:
    - package/vars.yml
    - docker/vars.yml
    - jenkins/vars.yml
    - nginx/vars.yml
    # secret files
    - nginx/secrets.yml

  tasks:
    - import_tasks: package/tasks.yml
    - import_tasks: docker/tasks.yml
    - import_tasks: jenkins/tasks.yml
    - import_tasks: nginx/tasks.yml


- hosts: setting
  vars_files:
    - jenkins/setting/vars.yml
    - jenkins/setting/auth/vars.yml
    # secret files
    - jenkins/setting/secrets.yml
    - jenkins/setting/auth/secrets.yml

  tasks:
    - import_tasks: jenkins/setting/tasks.yml
    - import_tasks: jenkins/setting/auth/tasks.yml

  handlers:
    - name: Restart Jenkins
      listen: "Restart Jenkins"
      community.docker.docker_container:
        name: bhevs-jenkins
        state: started
        restart: true
      delegate_to: 192.168.37.239
      become: false